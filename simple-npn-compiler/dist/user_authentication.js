const dynamicBtn=document.querySelectorAll("[data-nav-link]");async function fetchUserData(){var e=await fetch("./server/user_authentication_fetch_user.php").then(e=>{if(200===e.status)return e.text()});(e?(localStorage.setItem("userData",e),showUserIcon):showLogin)()}async function refreshSession(){var e,t;(localStorage.getItem("userData")&&localStorage.getItem("userPass")?(e=JSON.parse(localStorage.getItem("userData")),t=new FormData,type=e.username?"username":"email",t.append(type,e[type]),t.append("password",localStorage.getItem("userPass")),await fetch("./server/login.php",{method:"POST",body:t}),fetchUserData):showLogin)()}function showUserIcon(){null!==document.getElementById("default-account")&&(document.getElementById("default-account").style.display="block"),setDashboardLinks("./dashboard/create-survey"),showUserMenu()}function setDashboardLinks(e){for(var t=0,a=dynamicBtn.length;t<a;++t)dynamicBtn[t].href=e}function showUserMenu(){const t=document.getElementById("default-account-menu");var e;null!==t&&(e=JSON.parse(localStorage.getItem("userData")),type=e.username?"username":"email",document.getElementById("default-account-user-id").innerHTML=e[type],document.getElementById("logout").addEventListener("click",e=>{e.preventDefault(),logout()},{once:!0}));const a=document.getElementById("default-account-icon");null!==a&&(a.addEventListener("click",e=>{t.style.display=""===t.style.display?"block":""}),document.addEventListener("click",e=>{e.target===a||t.contains(e.target)||(t.style.display="")}))}function showLogin(){var e=document.getElementById("default-nav-login-btn");null!==e&&(e.style.display="block",setDashboardLinks("./login"))}function logout(){localStorage.clear(),sessionStorage.clear(),window.location.href="./"}(null!==sessionStorage.getItem("server-session")?localStorage.getItem("userData")?showUserIcon:fetchUserData:refreshSession)();